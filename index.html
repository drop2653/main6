<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>ë”°ì˜¤ê¸°ì™€ ëœ¸ë¶€ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            font-family: 'Pretendard', sans-serif;
            color: #333;
            text-align: center;
        }

        header {
            padding: 30px 20px 20px;
            font-size: 32px;
            font-weight: bold;
            background-color: #fff;
            border-bottom: 1px solid #eee;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        #start-screen,
        #game-screen,
        #end-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 100px);
            padding: 20px;
        }

        #start-screen {
            display: flex;
        }

        #end-screen {
            display: none;
        }

        button {
            margin-top: 30px;
            padding: 12px 32px;
            font-size: 18px;
            font-weight: bold;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        button:hover {
            background-color: #555;
        }

        #game-area {
            display: flex;
            justify-content: center;
            gap: 60px;
            padding: 40px 20px;
            flex-wrap: wrap;
        }

        .click-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 50%;
            opacity: 0.7;
            transform: scale(0);
            pointer-events: none;
            animation: click-pop 0.4s ease-out forwards;
            z-index: 9999;
        }

        @keyframes click-pop {
            to {
                transform: scale(2);
                opacity: 0;
            }
        }

        .video-box {
            background: white;
            border: 2px solid #ccc;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .red-glow {
            background-color: rgba(255, 0, 0, 0.08);
            /* ì—°í•œ ë¶‰ì€ ë°°ê²½ */
            border-color: crimson;
            /* í…Œë‘ë¦¬ ë¶‰ê²Œ */
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.5);
            /* ë¶‰ì€ë¹› glow */
            transition: all 0.3s ease;
        }

        video {
            width: 300px;
            height: auto;
            border-radius: 6px;
        }

        #heart-count {
            font-size: 60px;
            margin-top: 20px;
            transition: transform 0.2s ease;
        }

        .pop {
            transform: scale(1.4);
        }

        .effect-image {
            position: absolute;
            top: 60%;
            left: 50%;
            width: 300px;
            max-width: 90vw;
            transform: translate(-50%, -50%);
            z-index: 9999;
            animation: flash 0.8s infinite;
            pointer-events: none;
        }

        @keyframes flash {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        #result-img {
            width: auto;
            max-width: 80vw;
            height: auto;
            max-height: 80vh;
            margin-top: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        }

        #offset-info {
            margin-top: 10px;
            font-size: 17px;
            color: #c00;
        }

        .description {
            font-size: 25px;
            color: #555;
            margin-top: 10px;
            line-height: 1.6;
            max-width: 400px;
        }
    </style>
</head>

<body>

    <header>ë”°ì˜¤ê¸°ì™€ ëœ¸ë¶€ê¸°</header>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="start-screen">
        <div class="description">
            ëœ¸ë¶€ê¸° ì¡°ì‘ë²•<br><strong>ìŠ¤í˜ì´ìŠ¤ë°”</strong> ë˜ëŠ” <strong>ëœ¸ë¶€ê¸° í´ë¦­</strong><br><br>
            ë”°ì˜¤ê¸°ê°€ ìš¸ë©´,<br>ëœ¸ë¶€ê¸°ëŠ” ì •í™•íˆ <strong>1ì´ˆ</strong> ë•Œ<br>ë”°ë¼ ìš¸ì–´ì•¼ í•©ë‹ˆë‹¤.<br><br>
            ì‹¤íŒ¨í•˜ë©´...<br>ëœ¸ë¶€ê¸°ì˜ í–‰ë°©ì´ ë¬˜ì—°í•´ì§‘ë‹ˆë‹¤.
        </div>
        <button id="start-button">ê²Œì„ ì‹œì‘</button>
        <button id="hard-button" style="background-color: crimson;">ëœ¸ë¶€ê¸°ì˜ ë„ì „</button>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="game-screen">
        <audio id="bg-music" src="baserythme.mp3"></audio>
        <div id="heart-count">â¤ï¸ x 0</div>
        <div id="game-area">
            <div class="video-box" id="ddmbugi-box">
                <video id="ddmbugi" src="ddmbugi.webm" playsinline></video>
            </div>
            <div class="video-box">
                <video id="ddaogi" src="ddaogi.webm" preload="auto" playsinline></video>
            </div>
        </div>
    </div>

    <img id="effect-img" class="effect-image" src="" style="display:none;" />

    <!-- ê²Œì„ ì¢…ë£Œ í™”ë©´ -->
    <div id="end-screen">
        <div id="hard-mode-label"
            style="display:none; color:crimson; font-size: 36px; font-weight: bold; margin-bottom: 10px;">ëœ¸ë¶€ê¸°ì˜ ë„ì „</div>
        <h2 id="end-message"></h2>
        <div id="final-hearts"></div>
        <div id="offset-info"></div>
        <img id="result-img" src="" alt="">
        <button id="retry-button">ì¬ë„ì „</button>
    </div>

    <!-- ì‚¬ìš´ë“œ -->
    <audio id="ddmbugi-sound" src="ddmbugi.mp3"></audio>
    <audio id="ddaogi-sound" src="ddaogi.mp3"></audio>
    <audio id="success-sound" src="amateras.mp3"></audio>
    <audio id="fail-sound1" src="thunder.mp3"></audio>
    <audio id="fail-sound2" src="wow.mp3"></audio>
    <audio id="fail-sound3" src="nurang.mp3"></audio>
    <audio id="fail-sound4" src="ddaogirock.mp3"></audio>

    <script>
        if (/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            alert("ì´ ê²Œì„ì€ PCì—ì„œë§Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            document.body.innerHTML = "<h2 style='margin-top: 100px; font-size: 24px; color: crimson;'>âš ï¸ ëª¨ë°”ì¼ì—ì„œëŠ” ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>PCë¡œ ì ‘ì†í•´ì£¼ì„¸ìš”.</h2>";
        }
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const startButton = document.getElementById('start-button');
        const hardButton = document.getElementById('hard-button'); // ğŸ”´ ë„ì „ ë²„íŠ¼
        const retryButton = document.getElementById('retry-button');

        const ddmbugiVideo = document.getElementById('ddmbugi');
        const ddaogiVideo = document.getElementById('ddaogi');

        const ddmbugiSound = document.getElementById('ddmbugi-sound');
        const ddaogiSound = document.getElementById('ddaogi-sound');
        const bgMusic = document.getElementById('bg-music');
        const successSound = document.getElementById('success-sound');
        const failSound = document.getElementById('fail-sound');

        const heartCountDisplay = document.getElementById('heart-count');
        const endMessage = document.getElementById('end-message');
        const resultImg = document.getElementById('result-img');
        const finalHearts = document.getElementById('final-hearts');
        const offsetInfo = document.getElementById('offset-info');

        const failSound1 = document.getElementById('fail-sound1');
        const failSound2 = document.getElementById('fail-sound2');
        const failSound3 = document.getElementById('fail-sound3');
        const failSound4 = document.getElementById('fail-sound4');

        const ddmbugiEl = document.getElementById('ddmbugi');
        const ddaogiEl = document.getElementById('ddaogi');

        ddmbugiEl.addEventListener('click', (e) => {
            playDdmbugi();
            showClickEffect(e.clientX, e.clientY);
        });

        ddaogiEl.addEventListener('click', (e) => {
            showClickEffect(e.clientX, e.clientY);
        });

        let hearts = 0;
        let isListening = false;
        let responseStart = null;
        let responseTimer = null;
        let ddaogiInterval = null;

        let bgMusicStartTime = null;
        let bgMusicTick = 0;
        let bgMusicTimeout = null;
        let gameEnded = false;

        // âœ… í•˜ë“œëª¨ë“œ ê´€ë ¨
        let isHardMode = false;
        let winScore = 30;
        let ddaogiIntervalTime = 500;
        let ddaogiProbability = 0.25;
        let responseMin = 917;
        let responseMax = 1083;

        function startGame() {
            startScreen.style.display = 'none';
            gameScreen.style.display = 'flex';
            endScreen.style.display = 'none';

            hearts = 0;
            isListening = false;
            gameEnded = false;
            updateHeartDisplay();

            const ddmbugiBox = document.getElementById('ddmbugi-box');

            if (isHardMode) {
                ddmbugiBox.classList.add('red-glow'); // í•˜ë“œëª¨ë“œë©´ ë¶‰ì€ íš¨ê³¼ ì¼œê¸°
            } else {
                ddmbugiBox.classList.remove('red-glow'); // ì¼ë°˜ëª¨ë“œë©´ êº¼ë‘ê¸°
            }

            // âœ… ëª¨ë“œì— ë”°ë¼ ì„¤ì •
            winScore = isHardMode ? 60 : 30;
            ddaogiIntervalTime = isHardMode ? 250 : 500;
            ddaogiProbability = isHardMode ? 0.5 : 0.25;
            responseMin = isHardMode ? 917 : 876;
            responseMax = isHardMode ? 1083 : 1124;

            // âœ… ë°°ê²½ìŒì•… ì˜ˆì•½ ì‹œì‘
            bgMusicStartTime = performance.now();
            bgMusicTick = 0;
            scheduleNextBgMusic();

            ddmbugiVideo.pause();
            ddmbugiVideo.currentTime = 0;
            ddmbugiVideo.load();

            setTimeout(() => {
                playDdaogi();
                ddaogiInterval = setInterval(() => {
                    if (Math.random() < ddaogiProbability && !isListening) {
                        playDdaogi();
                    }
                }, ddaogiIntervalTime);
            }, 2000);
        }

        function showClickEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.style.left = `${x - 50}px`;
            effect.style.top = `${y - 50}px`;
            document.body.appendChild(effect);

            setTimeout(() => {
                effect.remove();
            }, 400);
        }

        function scheduleNextBgMusic() {
            const nextTarget = bgMusicStartTime + bgMusicTick * 8000;
            const now = performance.now();
            const delay = Math.max(0, nextTarget - now);

            bgMusicTimeout = setTimeout(() => {
                if (gameEnded) return;

                bgMusic.pause();
                bgMusic.currentTime = 0;
                bgMusic.play().catch((err) => {
                    console.warn('ë°°ê²½ìŒì•… ì¬ìƒ ì‹¤íŒ¨:', err);
                });

                bgMusicTick++;
                scheduleNextBgMusic();
            }, delay);
        }

        function playDdaogi() {
            ddaogiSound.pause();
            ddaogiSound.currentTime = 0;
            ddaogiSound.play();

            ddaogiVideo.currentTime = 0;
            ddaogiVideo.play();

            isListening = true;
            responseStart = performance.now();

            clearTimeout(responseTimer);
            responseTimer = setTimeout(() => {
                if (isListening) endGame(false);
            }, 1100);
        }

        function playDdmbugi() {
            if (!isListening) return;

            const now = performance.now();
            const diff = now - responseStart;

            if (diff >= responseMin && diff <= responseMax) {
                ddmbugiSound.pause();
                ddmbugiSound.currentTime = 0;
                ddmbugiSound.play();

                ddmbugiVideo.currentTime = 0;
                ddmbugiVideo.play();

                isListening = false;
                clearTimeout(responseTimer);

                hearts++;
                updateHeartDisplay(true);

                if (hearts >= winScore) endGame(true); // âœ… ìŠ¹ë¦¬ ì¡°ê±´
            } else {
                endGame(false, diff);
            }
        }

        function endGame(success, diff = null) {
            clearInterval(ddaogiInterval);
            clearTimeout(responseTimer);
            clearTimeout(bgMusicTimeout);
            gameEnded = true;
            isListening = false;

            const hardLabel = document.getElementById('hard-mode-label');
            hardLabel.style.display = isHardMode ? 'block' : 'none';

            gameScreen.style.display = 'none';
            endScreen.style.display = 'flex';

            bgMusic.pause();
            bgMusic.currentTime = 0;

            finalHearts.innerText = `â¤ï¸ ì´ ${hearts}ê°œ íšë“`;

            if (success) {
                endMessage.innerText = "ê³„íšëŒ€ë¡œ..\në”°ì˜¤ê¸°ì˜ ê³„íšì€ ì™„ë²½í–ˆìŠµë‹ˆë‹¤..";
                resultImg.src = "failsplan.png";
                successSound.play();
                const effect = document.getElementById("effect-img");
                effect.src = "faileye.png";
                effect.style.display = "block";
            } else {
                let h = hearts;
                if (isHardMode) h = Math.floor(h / 2); // í•˜ë“œëª¨ë“œëŠ” ê¸°ì¤€ì„ 2ë¡œ ë‚˜ëˆ ì„œ ë¹„êµ

                if (h <= 6) {
                    endMessage.innerText = "ëŒ€ì‹¤íŒ¨!\nëœ¸ë¶€ê¸°ëŠ” í¬ë¡œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤..";
                    resultImg.src = "ddmbugiprison.png";
                    failSound1.play();
                } else if (h <= 13) {
                    endMessage.innerText = "ì‹¤íŒ¨!\nì ì–´ë„ íƒˆì¶œì€ í–ˆë„¤ìš”.";
                    resultImg.src = "butboon.png";
                    failSound2.play();
                } else if (h === 14) {
                    endMessage.innerText = "ë ˆë‚˜ ë“±ì¥!\në ˆë‚˜ê°€ ì™œ ì—¬ê¸°ì—?";
                    resultImg.src = "lena.png";
                    failSound3.play();
                    const effect = document.getElementById("effect-img");
                    effect.src = "lenaeffect.png";
                    effect.style.display = "block";
                } else if (h <= 21) {
                    endMessage.innerText = "ì„±ê³µ!\nì¶©ë¶„íˆ ë†€ì•˜ìŠµë‹ˆë‹¤";
                    resultImg.src = "win.png";
                    failSound3.play();
                } else {
                    endMessage.innerText = "ëŒ€ì„±ê³µ!\nëœ¸ë¶€ê¸°ì˜ ë³¸ì‹¬ì´ì˜€ë„¤ìš”.";
                    resultImg.src = "ddaogiprison.png";
                    failSound4.play();
                }

                if (diff !== null) {
                    const offset = Math.round(diff - 1000);
                    const direction = offset < 0 ? "ë¹¨ëìŠµë‹ˆë‹¤" : "ëŠ¦ì—ˆìŠµë‹ˆë‹¤";
                    offsetInfo.innerText = `${Math.abs(offset)}ms ${direction}!`;
                }
            }
        }

        function updateHeartDisplay(withAnimation = false) {
            heartCountDisplay.innerText = `â¤ï¸ x ${hearts}`;
            if (withAnimation) {
                heartCountDisplay.classList.add('pop');
                setTimeout(() => {
                    heartCountDisplay.classList.remove('pop');
                }, 200);
            }
        }

        // ì¡°ì‘ ì´ë²¤íŠ¸
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') playDdmbugi();
        });

        document.addEventListener('click', () => {
            playDdmbugi();
        });

        startButton.addEventListener('click', (e) => {
            e.stopPropagation();
            isHardMode = false;
            startGame();
        });

        hardButton.addEventListener('click', (e) => {
            e.stopPropagation();
            isHardMode = true;
            startGame();
        });

        retryButton.addEventListener('click', () => {
            location.reload();
        });
    </script>
</body>

</html>
